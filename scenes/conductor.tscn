[gd_scene load_steps=7 format=3 uid="uid://ddxdmm11giomp"]

[ext_resource type="Script" path="res://scripts/Song.gd" id="1_roxhu"]
[ext_resource type="Script" path="res://scripts/Chart.gd" id="2_688ux"]

[sub_resource type="GDScript" id="GDScript_tub2h"]
script/source = "extends Node
signal songfile_change_internal
signal songfile_change

@onready var song = get_node(\"AudioStreamPlayer\")
var time_signature : Vector2 = Vector2(4, 4)
var seconds_per_beat : float = 0.0
var seconds_per_measure : float = 0.0
var bpm : float = 120.0
var song_path : String

func _on_songfile_change_internal():
	if seconds_per_beat != 60/song.stream.get_bpm():
		seconds_per_beat = 60/song.stream.get_bpm()
	
	if seconds_per_measure != seconds_per_beat * time_signature.x:
		seconds_per_measure = seconds_per_beat * time_signature.x
	
	if bpm != song.stream.get_bpm():
		bpm = song.stream.get_bpm()
	
	emit_signal(\"songfile_change\")
	
func song_is_playing() -> bool:
	return song.is_playing()

func set_song_file(filepath) -> void:
	var new_song = load(filepath)
	song_path = filepath
	song.stream = new_song
	emit_signal(\"songfile_change_internal\")
	
func play_song() -> void:
	song.play()

func get_seconds_per_beat() -> float:
	return seconds_per_beat

func get_seconds_per_measure() -> float:
	return seconds_per_measure

func get_bpm() -> float:
	return bpm

func set_bpm(new_bpm : float) -> void:
	song.stream.set_bpm(new_bpm)

func get_song_path() -> String:
	return song_path

func get_playback_position() -> float:
	return song.get_playback_position()
"

[sub_resource type="Resource" id="Resource_mb7gr"]
script = ExtResource("1_roxhu")
name = ""
artist = ""
jacket_aritst = ""

[sub_resource type="Resource" id="Resource_x88cm"]
script = ExtResource("2_688ux")
charter = ""
offset = 0.0
bpm = 0.0
length = 0.0
difficulty = 0
rating = 0.0
notes = []

[sub_resource type="AudioStream" id="AudioStream_s78t4"]

[node name="Conductor" type="Node"]
script = SubResource("GDScript_tub2h")
metadata/Song = SubResource("Resource_mb7gr")
metadata/Chart = SubResource("Resource_x88cm")

[node name="AudioStreamPlayer" type="AudioStreamPlayer" parent="."]
stream = SubResource("AudioStream_s78t4")

[connection signal="songfile_change_internal" from="." to="." method="_on_songfile_change_internal"]
